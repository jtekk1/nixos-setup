{ pkgs, config, ... }:

let
  mod = "SUPER";
  mainMod = mod;
  shiftMod = "${mod} SHIFT";
  ctrlMod = "${mod} CTRL";
  shiftCtrl = "CTRL SHIFT";

  app = "uwsm app --";
  tty = "${app} kitty";
  terminal = tty;
  browser = "chromium";
  webapp = url: "${app} ${browser} --app=${url}";
  fileManager = "${terminal} superfile";

  # Webapp shortcuts using centralized webapp module
  wa = config.programs.webapps.apps;

  osdclient = ''swayosd-client --monitor "$(hyprctl monitors -j | jq -r '.[] | select(.focused == true).name')"'';
in {
  wayland.windowManager.hyprland.settings = {
    bind = [
      # Apps bindings
      "${mod}, Return, exec, ${tty} --working-directory=$(open-terminal)"
      "${mod}, slash, exec, ${app} bitwarden"
      "${mod}, B, exec, ${terminal} btop"
      "${mod}, C, exec, ${app} cursor"
      "${mod}, D, exec, ${terminal} lazydocker"
      "${mod}, F, exec, ${fileManager}"
      "${mod}, L, exec, ${app} hyprlock"
      "${mod}, M, exec, ${app} spotify"
      "${mod}, N, exec, ${terminal} nvim"
      "${mod}, O, exec, ${app} obsidian"
      "${mod}, T, exec, ${browser}"
      "${mod}, X, exec, ${terminal} claude"
      "${shiftCtrl}, 4, exec, hyprshot -m region --clipboard-only"
      "${shiftCtrl}, space, exec, ${webapp wa.nerdfonts-cheatsheet.url}"

      # Webapps bindings (managed by programs.webapps module)
      "${shiftMod}, A, exec, ${webapp wa.gemini.url}"
      "${shiftMod}, C, exec, ${webapp wa.claude.url}"
      "${shiftMod}, G, exec, ${webapp wa.chatgpt.url}"
      "${shiftMod}, H, exec, ${webapp wa.hbomax.url}"
      "${shiftMod}, I, exec, ${webapp wa.instagram.url}"
      "${shiftMod}, M, exec, ${webapp wa.zohomail.url}"
      "${shiftMod}, N, exec, ${webapp wa.netflix.url}"
      "${shiftMod}, T, exec, ${webapp wa.teams.url}"
      "${shiftMod}, U, exec, ${webapp wa.upwork.url}"
      "${shiftMod}, Y, exec, ${webapp wa.youtube.url}"


      # Tiling bindings
      "SUPER, W, killactive,"
      "CTRL ALT, DELETE, exec, close-all-windows"
      "SUPER, J, togglesplit,"
      "SUPER, P, pseudo,"
      "SUPER, V, togglefloating,"
      "SHIFT, F11, fullscreen, 0"

      # Move focus
      "SUPER, left, movefocus, l"
      "SUPER, right, movefocus, r"
      "SUPER, up, movefocus, u"
      "SUPER, down, movefocus, d"

      # Switch workspaces
      "SUPER, 1, workspace, 1"
      "SUPER, 2, workspace, 2"
      "SUPER, 3, workspace, 3"
      "SUPER, 4, workspace, 4"
      "SUPER, 5, workspace, 5"
      "SUPER, 6, workspace, 6"
      "SUPER, 7, workspace, 7"
      "SUPER, 8, workspace, 8"
      "SUPER, 9, workspace, 9"
      "SUPER, 0, workspace, 10"

      # Move active window to workspace
      "SUPER SHIFT, 1, movetoworkspace, 1"
      "SUPER SHIFT, 2, movetoworkspace, 2"
      "SUPER SHIFT, 3, movetoworkspace, 3"
      "SUPER SHIFT, 4, movetoworkspace, 4"
      "SUPER SHIFT, 5, movetoworkspace, 5"
      "SUPER SHIFT, 6, movetoworkspace, 6"
      "SUPER SHIFT, 7, movetoworkspace, 7"
      "SUPER SHIFT, 8, movetoworkspace, 8"
      "SUPER SHIFT, 9, movetoworkspace, 9"
      "SUPER SHIFT, 0, movetoworkspace, 10"

      # Tab between workspaces
      "SUPER, TAB, workspace, e+1"
      "SUPER SHIFT, TAB, workspace, e-1"

      # Swap active window
      "SUPER SHIFT, left, swapwindow, l"
      "SUPER SHIFT, right, swapwindow, r"
      "SUPER SHIFT, up, swapwindow, u"
      "SUPER SHIFT, down, swapwindow, d"

      # Cycle through applications
      "ALT, Tab, cyclenext"
      "ALT SHIFT, Tab, cyclenext, prev"
      "ALT, Tab, bringactivetotop"
      "ALT SHIFT, Tab, bringactivetotop"

      # Resize active window
      "SUPER, minus, resizeactive, -100 0"
      "SUPER, equal, resizeactive, 100 0"
      "SUPER SHIFT, minus, resizeactive, 0 -100"
      "SUPER SHIFT, equal, resizeactive, 0 100"

      # Scroll through workspaces
      "SUPER, mouse_down, workspace, e+1"
      "SUPER, mouse_up, workspace, e-1"

      # Wofi menus
      "${mod}, space, exec, ${app} wofi --show drun"
      "${mod}, R, exec, ${app} wofi --show run"
      "${mod}, ESCAPE, exec, ~/.local/bin/wofi-power-menu"
      "${mod}, V, exec, ~/.local/bin/wofi-clipboard-menu"
      "${ctrlMod}, TAB, exec, ~/.local/bin/wofi-window-switcher"

      # Notifications
      "SUPER, COMMA, exec, makoctl dismiss"
      "SUPER SHIFT, COMMA, exec, makoctl dismiss --all"
      "SUPER CTRL, COMMA, exec, makoctl mode -t do-not-disturb && makoctl mode | grep -q 'do-not-disturb' && notify-send \"Silenced notifications\" || notify-send \"Enabled notifications\""

      # Toggle features
      "SUPER CTRL, N, exec, toggle-nightlight"

      # Color picker
      "SUPER, PRINT, exec, pkill hyprpicker || hyprpicker -a"

      # Wallpaper management
      "SUPER ALT, W, exec, unified-wallpaper"  # Next wallpaper
      "SUPER ALT SHIFT, W, exec, unified-wallpaper --random"  # Random wallpaper
      "SUPER ALT, T, exec, unified-wallpaper --time"  # Time-based wallpaper

    ];

    bindl = [
      ", XF86AudioNext, exec, ${osdclient} --playerctl next"
      ", XF86AudioPause, exec, ${osdclient} --playerctl play-pause"
      ", XF86AudioPlay, exec, ${osdclient} --playerctl play-pause"
      ", XF86AudioPrev, exec, ${osdclient} --playerctl previous"
    ];

    bindel = [
      ", XF86AudioRaiseVolume, exec, ${osdclient} --output-volume raise"
      ", XF86AudioLowerVolume, exec, ${osdclient} --output-volume lower"
      ", XF86AudioMute, exec, ${osdclient} --output-volume mute-toggle"
      ", XF86AudioMicMute, exec, ${osdclient} --input-volume mute-toggle"
      ", XF86MonBrightnessUp, exec, ${osdclient} --brightness raise"
      ", XF86MonBrightnessDown, exec, ${osdclient} --brightness lower"
      "ALT, XF86AudioRaiseVolume, exec, ${osdclient} --output-volume +1"
      "ALT, XF86AudioLowerVolume, exec, ${osdclient} --output-volume -1"
      "ALT, XF86MonBrightnessUp, exec, ${osdclient} --brightness +1"
      "ALT, XF86MonBrightnessDown, exec, ${osdclient} --brightness -1"
    ];

    bindm = [
      "SUPER, mouse:272, movewindow"
      "SUPER, mouse:273, resizewindow"
    ];
  };
}
